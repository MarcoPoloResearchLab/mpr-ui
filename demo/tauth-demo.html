<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TAuth + mpr-ui (Docker Compose)</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/MarcoPoloResearchLab/mpr-ui@latest/mpr-ui.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/module.esm.js"
      type="module"
    ></script>
    <script
      defer
      src="http://localhost:8080/static/auth-client.js"
      crossorigin="anonymous"
    ></script>
    <script
      id="mpr-ui-bundle"
      defer
      src="/mpr-ui.js"
    ></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      :root {
        --card-background: rgba(255, 255, 255, 0.9);
        --card-border: rgba(0, 0, 0, 0.1);
      }
      body.theme-dark {
        --card-background: rgba(18, 21, 23, 0.8);
        --card-border: rgba(255, 255, 255, 0.2);
      }
      main {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 1.5rem 3rem;
      }
      .demo-section {
        margin-top: 2rem;
      }
      .session-card {
        border: 1px solid var(--card-border);
        border-radius: 0.75rem;
        padding: 1.25rem;
        background: var(--card-background);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      }
      .session-card__profile {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      .session-card__profile ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .session-card__profile li + li {
        margin-top: 0.25rem;
      }
      .session-card__avatar {
        width: 56px;
        height: 56px;
        border-radius: 999px;
        object-fit: cover;
      }
      .session-card__expires {
        margin-top: 1rem;
        font-size: 0.95rem;
        color: var(--mpr-color-text-muted, #555);
      }
      .logout-button {
        margin-top: 1rem;
        border: 0;
        border-radius: 999px;
        padding: 0.75rem 1.5rem;
        background: #0c67ff;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      .logout-button:hover {
        background: #0842a8;
      }
      ol {
        padding-left: 1.25rem;
      }
      ol li + li {
        margin-top: 0.5rem;
      }
    </style>
  </head>
  <body class="theme-light" data-demo-palette="default">
    <mpr-header
      id="demo-header"
      brand-label="Marco Polo Research Lab"
      brand-href="https://mprlab.com/"
      nav-links='[
        { "label": "Docs", "href": "https://github.com/MarcoPoloResearchLab/mpr-ui/blob/master/README.md" },
        { "label": "Architecture", "href": "https://github.com/MarcoPoloResearchLab/mpr-ui/blob/master/ARCHITECTURE.md" }
      ]'
      site-id="991677581607-r0dj8q6irjagipali0jpca7nfp8sfj9r.apps.googleusercontent.com"
      base-url="http://localhost:8080"
      login-path="/auth/google"
      logout-path="/auth/logout"
      nonce-path="/auth/nonce"
      settings="true"
      settings-label="Settings"
    ></mpr-header>
    <main>
      <h1>Docker Compose demo</h1>
      <p>
        This page connects the <code>mpr-header</code> web component to a local
        TAuth service running under Docker Compose. Sign in with Google, observe
        the authenticated profile state, and use the logout button to clear your
        session.
      </p>

      <section aria-labelledby="profile-status-title" class="demo-section">
        <h2 id="profile-status-title">Current session</h2>
        <p>
          Google sign-in requests are exchanged with
          <code>http://localhost:8080</code>. The helper script provided by TAuth
          monitors <code>/me</code> and <code>/auth/refresh</code> to keep a
          valid browser session without storing tokens in localStorage.
        </p>
        <div
          class="session-card"
          data-demo-auth-status
          aria-live="polite"
          aria-atomic="true"
        >
          <p>Awaiting connection to the TAuth service…</p>
        </div>
        <button type="button" class="logout-button" data-demo-logout>
          Sign out
        </button>
      </section>

      <section aria-labelledby="instructions-title" class="demo-section">
        <h2 id="instructions-title">How it works</h2>
        <ol>
          <li>The frontend is served by the gHTTP container on port 8000.</li>
          <li>
            TAuth listens on port 8080, issuing HttpOnly session cookies scoped
            to <code>localhost</code>.
          </li>
          <li>
            The header component requests <code>/auth/nonce</code> before
            rendering the Google button and exchanges the returned credential via
            <code>/auth/google</code>.
          </li>
          <li>
            The embedded <code>auth-client.js</code> helper refreshes sessions by
            calling <code>/auth/refresh</code> whenever a request returns 401.
          </li>
          <li>
            Clicking <strong>Sign out</strong> invokes <code>/auth/logout</code>
            and resets the profile snapshot below.
          </li>
        </ol>
      </section>
    </main>

    <mpr-footer
      id="page-footer"
      prefix-text="Built by Marco Polo Research Lab"
      privacy-link-label="Privacy &amp; Terms"
      privacy-link-href="#privacy"
      privacy-modal-content="
        <h1>Privacy Policy — TAuth demo</h1>
        <p><strong>Effective Date:</strong> 2025-10-11</p>
        <p>The local demo exchanges your Google profile with a self-hosted TAuth instance.</p>
        <p>No data leaves your machine, and session cookies are cleared when you stop the Compose stack.</p>
      "
      links-collection='{
        "style": "drop-up",
        "text": "Explore more demos",
        "links": [
          { "label": "Marco Polo Research Lab", "url": "https://mprlab.com" },
          { "label": "LoopAware", "url": "https://loopaware.mprlab.com" },
          { "label": "Gravity Notes", "url": "https://gravity.mprlab.com" },
          { "label": "Allergy Wheel", "url": "https://allergy.mprlab.com" },
          { "label": "Countdown Calendar", "url": "https://countdown.mprlab.com" }
        ]
      }'
      theme-switcher="square"
      theme-config='{"attribute":"data-demo-theme","targets":["body"],"initialMode":"default-light","modes":[{"value":"default-light","attributeValue":"light","classList":["theme-light"],"dataset":{"data-demo-palette":"default"}},{"value":"sunrise-light","attributeValue":"light","classList":["theme-light"],"dataset":{"data-demo-palette":"sunrise"}},{"value":"default-dark","attributeValue":"dark","classList":["theme-dark"],"dataset":{"data-demo-palette":"default"}},{"value":"forest-dark","attributeValue":"dark","classList":["theme-dark"],"dataset":{"data-demo-palette":"forest"}}]}'
    ></mpr-footer>
    <script defer src="./status-panel.js"></script>
  </body>
</html>
