<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Standalone Login Button + TAuth</title>
    <link rel="stylesheet" href="./mpr-ui.css" />
    <link rel="stylesheet" href="./demo.css" />
    <script defer src="./standalone-config.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/module.esm.js"
      type="module"
    ></script>
    <!-- TAuth helper proxied through ghttp for same-origin operation -->
    <script defer src="/tauth.js"></script>
    <script id="mpr-ui-bundle" defer src="./mpr-ui.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      body {
        background: var(--mpr-color-surface-primary, #f8fafc);
        color: var(--mpr-color-text-primary, #0f172a);
        min-height: 100vh;
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .page-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      main {
        flex: 1;
        max-width: 720px;
        margin: 0 auto;
        padding: 3rem 1.5rem;
      }
      h1 {
        margin: 0 0 0.5rem;
        font-size: 2rem;
      }
      .subtitle {
        color: var(--mpr-color-text-muted, #64748b);
        margin: 0 0 2.5rem;
        font-size: 1.1rem;
      }
      .auth-section {
        margin-bottom: 2.5rem;
      }
      .auth-section h2 {
        font-size: 1.25rem;
        margin: 0 0 1rem;
      }
      /* Use mpr-ui design tokens for cards */
      .mpr-card-container {
        border: 1px solid var(--mpr-color-border, rgba(148,163,184,0.35));
        border-radius: 0.75rem;
        padding: 1.5rem;
        background: var(--mpr-color-surface-elevated, #ffffff);
        box-shadow: var(--mpr-shadow-elevated, 0 8px 16px rgba(15,23,42,0.18));
      }
      .mpr-card-container--centered {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        text-align: center;
      }
      .mpr-card-container p {
        margin: 0;
        color: var(--mpr-color-text-muted, #64748b);
      }
      .mpr-card-container mpr-login-button {
        margin-top: 0.5rem;
      }
      .session-profile {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      .session-profile ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .session-profile li + li {
        margin-top: 0.25rem;
      }
      .session-avatar {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--mpr-color-border, rgba(148,163,184,0.35));
      }
      .session-expires {
        margin-top: 1rem;
        font-size: 0.95rem;
        color: var(--mpr-color-text-muted, #64748b);
      }
      .user-menu-section {
        margin-top: 2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: relative;
        z-index: 10;
      }
      .user-menu-section p {
        margin: 0;
        color: var(--mpr-color-text-muted, #64748b);
      }
      .info-section {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid var(--mpr-color-border, rgba(148,163,184,0.35));
      }
      .info-section h2 {
        font-size: 1.25rem;
        margin: 0 0 1rem;
      }
      .info-section ul {
        padding-left: 1.25rem;
        color: var(--mpr-color-text-muted, #64748b);
      }
      .info-section li + li {
        margin-top: 0.5rem;
      }
      .info-section code {
        background: var(--mpr-chip-bg, rgba(148,163,184,0.18));
        padding: 0.15rem 0.4rem;
        border-radius: 0.25rem;
        font-size: 0.9em;
      }
      [hidden] {
        display: none !important;
      }
    </style>
  </head>
  <body data-mpr-theme="light">
    <div class="page-container">
      <main>
        <h1>Standalone Login Button</h1>
        <p class="subtitle">
          Using <code>&lt;mpr-login-button&gt;</code> and
          <code>&lt;mpr-user&gt;</code> without the header component.
        </p>

        <section class="auth-section" data-auth-state="signed-out">
          <h2>Sign in</h2>
          <div class="mpr-card-container mpr-card-container--centered" id="login-card">
            <p>Click the button below to sign in with Google via TAuth.</p>
            <mpr-login-button
              id="demo-login-button"
              button-size="large"
              button-theme="outline"
              button-text="signin_with"
              tauth-login-path="/auth/google"
              tauth-logout-path="/auth/logout"
              tauth-nonce-path="/auth/nonce"
            ></mpr-login-button>
          </div>
        </section>

        <section class="auth-section" id="session-section" hidden>
          <h2>Current session</h2>
          <div
            class="mpr-card-container"
            data-demo-auth-status
            aria-live="polite"
            aria-atomic="true"
          >
            <p>Loading session...</p>
          </div>
          <div class="user-menu-section">
            <p>Profile menu:</p>
            <mpr-user
              id="demo-user-menu"
              display-mode="avatar-name"
              logout-url="/demo/standalone.html"
              logout-label="Sign out"
              menu-items='[{"label":"Account","href":"#account"},{"label":"Settings","action":"open-settings"}]'
            ></mpr-user>
          </div>
        </section>

        <section class="info-section">
          <h2>How this demo works</h2>
          <ul>
            <li>
              <code>&lt;mpr-login-button&gt;</code> renders the Google Sign-In
              button via GIS and handles the credential exchange with TAuth.
            </li>
            <li>
              <code>&lt;mpr-user&gt;</code> displays the authenticated profile
              and provides a dropdown with menu items and logout action.
            </li>
            <li>
              Both components listen for <code>mpr-ui:auth:*</code> events to
              stay in sync with the session state.
            </li>
            <li>
              TAuth endpoints (<code>/auth/nonce</code>,
              <code>/auth/google</code>, <code>/auth/logout</code>) handle the
              backend exchange.
            </li>
            <li>
              This pattern is useful for login pages, sidebars, or anywhere you
              need auth controls without the full header.
            </li>
          </ul>
        </section>
      </main>

      <mpr-footer
        id="page-footer"
        prefix-text="Built by Marco Polo Research Lab"
        privacy-link-label="Privacy &amp; Terms"
        privacy-link-href="#privacy"
        links-collection='{
          "style": "drop-up",
          "text": "More demos",
          "links": [
            { "label": "TAuth Demo", "url": "/demo/tauth-demo.html" },
            { "label": "Local Demo", "url": "/demo/local.html" },
            { "label": "Index Demo", "url": "/demo/index.html" }
          ]
        }'
        theme-switcher="toggle"
        theme-config='{"attribute":"data-mpr-theme","targets":["body"],"initialMode":"light","modes":[{"value":"light","attributeValue":"light"},{"value":"dark","attributeValue":"dark"}]}'
      ></mpr-footer>
    </div>

    <script defer src="./status-panel.js"></script>
    <script>
      (function() {
        // Apply TAUTH_DEMO_CONFIG to standalone elements
        function applyConfig() {
          var config = window.TAUTH_DEMO_CONFIG || {};
          var loginButton = document.getElementById('demo-login-button');
          var userMenu = document.getElementById('demo-user-menu');
          if (loginButton) {
            if (config.googleClientId) loginButton.setAttribute('site-id', config.googleClientId);
            if (config.tauthUrl) loginButton.setAttribute('tauth-url', config.tauthUrl);
            if (config.tenantId) loginButton.setAttribute('tauth-tenant-id', config.tenantId);
          }
          if (userMenu && config.tenantId) {
            userMenu.setAttribute('tauth-tenant-id', config.tenantId);
          }
        }

        // Toggle visibility based on auth state
        function updateAuthVisibility(isAuthenticated) {
          var loginCard = document.getElementById('login-card');
          var sessionSection = document.getElementById('session-section');
          if (loginCard) loginCard.hidden = isAuthenticated;
          if (sessionSection) sessionSection.hidden = !isAuthenticated;
        }

        function init() {
          applyConfig();
          var currentUser = typeof window.getCurrentUser === 'function' ? window.getCurrentUser() : null;
          updateAuthVisibility(Boolean(currentUser));

          document.addEventListener('mpr-ui:auth:authenticated', function() {
            updateAuthVisibility(true);
          });
          document.addEventListener('mpr-ui:auth:unauthenticated', function() {
            updateAuthVisibility(false);
          });
          document.addEventListener('mpr-user:menu-item', function(event) {
            if (event.detail && event.detail.action === 'open-settings') {
              alert('Settings action triggered! Wire your own modal here.');
            }
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
      })();
    </script>
  </body>
</html>
